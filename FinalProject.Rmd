---
title: "Final"
output: html_document
date: "2025-05-02"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
```{r}
library(ggplot2)
library(dplyr) 
# Step 1: Load the data
data <- read.csv("cox-violent-parsed_filt.csv")

# Step 2: Clean and standardize sex column
data$sex <- trimws(tolower(data$sex))  # Remove spaces and standardize to lowercase
data$sex[data$sex == "male"] <- "Male"
data$sex[data$sex == "female"] <- "Female"

# Step 3: Keep only Male and Female rows
data <- data[data$sex %in% c("Male", "Female"), ]

# Step 4: Parse datetime columns
data$jail_in <- as.POSIXct(data$c_jail_in, format="%m/%d/%Y %H:%M")
data$jail_out <- as.POSIXct(data$c_jail_out, format="%m/%d/%Y %H:%M")

# Step 5: Calculate sentence duration
data$sentence_days <- as.numeric(difftime(data$jail_out, data$jail_in, units = "days"))

# Step 6: Remove invalid sentence durations
data <- data[!is.na(data$sentence_days) & data$sentence_days >= 0, ]

# Step 7: Run the t-test
t_result <- t.test(sentence_days ~ sex, data = data)
print(t_result)

# Step 8: Boxplot for visualization
boxplot(sentence_days ~ sex, data = data,
        main = "Sentence Length (Days) by Sex",
        xlab = "Sex", ylab = "Sentence Length (Days)", col = c("lightblue", "pink"))

ggplot(data, aes(x = sentence_days, fill = sex)) +
  geom_density(alpha = 0.6, color = "black") +
  facet_wrap(~ sex, scales = "free_y") +
  labs(title = "Density of Sentence Length by Sex",
       x = "Sentence Length (Days)", y = "Density") +
  theme_minimal()


```
```{r}
# Drop NA or negative sentence lengths
data <- data[!is.na(data$sentence_days) & data$sentence_days >= 0, ]

# Ensure is_recid is numeric (if it's not already, this won't do anything harmful)
data$is_recid <- as.numeric(as.character(data$is_recid))

# Safely convert is_recid to a factor with labeled levels
data$is_recid <- factor(data$is_recid, levels = c(0, 1),
                        labels = c("Not_Reconvicted", "Reconvicted"))

# Confirm the unique values in is_recid
print(unique(data$is_recid))

# Calculate total count by gender
gender_counts <- table(data$sex)

# Calculate proportions (percent of each gender)
gender_proportions <- prop.table(gender_counts)
percentages <- round(100 * gender_proportions, 2)
print(percentages)

# Create recidivism table by gender
recid_table <- table(data$sex, data$is_recid)
print(recid_table)

# Total number of people
total_people <- sum(recid_table)
cat("Total number of people:", total_people, "\n")

# Total by gender
total_by_gender <- rowSums(recid_table)
cat("Total women:", total_by_gender["Female"], "\n")
cat("Total men:", total_by_gender["Male"], "\n")

# Total by recidivism status (optional)
total_by_recid <- colSums(recid_table)
cat("Not Reconvicted:", total_by_recid["Not_Reconvicted"], "\n")
cat("Reconvicted:", total_by_recid["Reconvicted"], "\n")


```
```{r}
table(data$sex, data$c_charge_desc)
library(dplyr)
data %>%
  group_by(sex, c_charge_desc) %>%
  summarise(count = n(), .groups = "drop") %>%
  arrange(sex, desc(count)) %>%
  group_by(sex) %>%
  slice_head(n = 5)
table(data$sex, data$priors_count)  # if that column exists
aggregate(priors_count ~ sex, data, mean)



```
```{r}
str(data$r_jail_out)
unique(data$r_jail_out[!is.na(data$r_jail_out)][1:10])

```


