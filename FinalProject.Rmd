---
title: "Final"
output: html_document
date: "2025-05-02"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
```{r}
library(ggplot2)
library(dplyr) 
# Step 1: Load the data
data <- read.csv("cox-violent-parsed_filt.csv")

# Step 2: Clean and standardize sex column
data$sex <- trimws(tolower(data$sex))  # Remove spaces and standardize to lowercase
data$sex[data$sex == "male"] <- "Male"
data$sex[data$sex == "female"] <- "Female"

# Step 3: Keep only Male and Female rows
data <- data[data$sex %in% c("Male", "Female"), ]

# Step 4: Parse datetime columns
data$jail_in <- as.POSIXct(data$c_jail_in, format="%m/%d/%Y %H:%M")
data$jail_out <- as.POSIXct(data$c_jail_out, format="%m/%d/%Y %H:%M")

# Step 5: Calculate sentence duration
data$sentence_days <- as.numeric(difftime(data$jail_out, data$jail_in, units = "days"))

# Step 6: Remove invalid sentence durations
data <- data[!is.na(data$sentence_days) & data$sentence_days >= 0, ]

# Step 7: Run the t-test
t_result <- t.test(sentence_days ~ sex, data = data)
print(t_result)

# Step 8: Boxplot for visualization
boxplot(sentence_days ~ sex, data = data,
        main = "Sentence Length (Days) by Sex",
        xlab = "Sex", ylab = "Sentence Length (Days)", col = c("lightblue", "pink"))

ggplot(data, aes(x = sentence_days, fill = sex)) +
  geom_density(alpha = 0.6, color = "black") +
  facet_wrap(~ sex, scales = "free_y") +
  labs(title = "Density of Sentence Length by Sex",
       x = "Sentence Length (Days)", y = "Density") +
  theme_minimal()

unique(data$c_charge_desc)
# Drop NA sentence_days (already done if you're reusing filtered data)
data <- data[!is.na(data$sentence_days) & data$sentence_days >= 0, ]

# Calculate total count by gender
gender_counts <- table(data$sex)

# Calculate proportions
gender_proportions <- prop.table(gender_counts)

# Print proportions as percentages
percentages <- round(100 * gender_proportions, 2)
print(percentages)
recid_table <- table(data$sex, data$is_recid)

# Check unique values in is_recid
unique(data$is_recid)  # should include 0 and 1

# Convert is_recid to factor to ensure both levels are included
data$is_recid <- factor(data$is_recid, levels = c(0, 1), labels = c("Not_Reconvicted", "Reconvicted"))

# Create a cross-tabulation
recid_table <- table(data$sex, data$is_recid)

# Print the table
print(recid_table)


# Filter reconvicted individuals with valid sentence_days
reconvicted <- data[data$is_recid == 1 & data$sex %in% c("Male", "Female") & !is.na(data$sentence_days), ]

# Reconvicted males
male_data <- reconvicted[reconvicted$sex == "Male", ]
male_mean <- mean(male_data$sentence_days)
male_sd <- sd(male_data$sentence_days)

# Reconvicted females
female_data <- reconvicted[reconvicted$sex == "Female", ]
female_mean <- mean(female_data$sentence_days)
female_sd <- sd(female_data$sentence_days)

# Print results
cat("Reconvicted Males:\n")
cat("  Mean Sentence Length:", round(male_mean, 2), "days\n")
cat("  Std Dev:", round(male_sd, 2), "days\n\n")

cat("Reconvicted Females:\n")
cat("  Mean Sentence Length:", round(female_mean, 2), "days\n")
cat("  Std Dev:", round(female_sd, 2), "days\n")
data$sentence_days <- as.numeric(difftime(data$c_jail_out, data$c_jail_in, units = "days"))
data <- data[!is.na(data$sentence_days) & data$sentence_days >= 0, ]

```
```{r}
library(dplyr)

# Parse the second set of jail datetime columns for reconviction
data$r_jail_in <- as.POSIXct(data$r_jail_in, format = "%m/%d/%Y %H:%M")
data$r_jail_out <- as.POSIXct(data$r_jail_out, format = "%m/%d/%Y %H:%M")

# Calculate sentence duration for reconvicted individuals
data$recid_sentence_days <- as.numeric(difftime(data$r_jail_out, data$r_jail_in, units = "days"))

# Filter reconvicted people with valid durations
recid_data <- data %>%
  filter(is_recid == "Reconvicted", sex %in% c("Male", "Female"), !is.na(recid_sentence_days), recid_sentence_days >= 0)

# Calculate mean and standard deviation by gender
mean_male <- mean(recid_data$recid_sentence_days[recid_data$sex == "Male"])
sd_male <- sd(recid_data$recid_sentence_days[recid_data$sex == "Male"])

mean_female <- mean(recid_data$recid_sentence_days[recid_data$sex == "Female"])
sd_female <- sd(recid_data$recid_sentence_days[recid_data$sex == "Female"])

# Print results
cat("Reconvicted Males:\n")
cat("  Mean Sentence Length:", round(mean_male, 2), "days\n")
cat("  Std Dev:", round(sd_male, 2), "days\n\n")

cat("Reconvicted Females:\n")
cat("  Mean Sentence Length:", round(mean_female, 2), "days\n")
cat("  Std Dev:", round(sd_female, 2), "days\n")

```
```{r}
data$r_jail_in <- as.POSIXct(data$r_jail_in, format = "%m/%d/%Y %H:%M")
data$r_jail_out <- as.POSIXct(data$r_jail_out, format = "%m/%d/%Y %H:%M")

# Create a separate sentence length field for reconviction
data$recid_sentence_days <- as.numeric(difftime(data$r_jail_out, data$r_jail_in, units = "days"))
recid_data <- data[data$is_recid == "Reconvicted" & !is.na(data$recid_sentence_days), ]

mean_male <- mean(recid_data$recid_sentence_days[recid_data$sex == "Male"])
sd_male <- sd(recid_data$recid_sentence_days[recid_data$sex == "Male"])

mean_female <- mean(recid_data$recid_sentence_days[recid_data$sex == "Female"])
sd_female <- sd(recid_data$recid_sentence_days[recid_data$sex == "Female"])

cat("Reconvicted Males:\n  Mean:", round(mean_male, 2), "days\n  SD:", round(sd_male, 2), "days\n\n")
cat("Reconvicted Females:\n  Mean:", round(mean_female, 2), "days\n  SD:", round(sd_female, 2), "days\n")


```

